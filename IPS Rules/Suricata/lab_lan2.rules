#############################################
# LAB_LAN2 Suricata Rules
# Network: 192.168.200.0/24
#############################################

# ====== SSH / LINUX ======

alert tcp any any -> 192.168.200.0/24 22 \
(msg:"LAB2: SSH Brute Force Attempt"; flags:S; detection_filter:track by_src, count 5, seconds 60; sid:920001; rev:2;)

alert tcp 192.168.2.0/24 any -> 192.168.200.0/24 22 \
(msg:"LAB2: SSH Attempt from EXT_LAN"; sid:920002; rev:1;)

alert tcp any any -> 192.168.200.0/24 22 \
(msg:"LAB2: sudo Keyword in SSH Session"; content:"sudo"; sid:920003; rev:1;)


# ====== RECON / SCANNING ======

alert tcp any any -> 192.168.200.0/24 any \
(msg:"LAB2: Nmap OS Detection Scan"; content:"|4E 4D 41 50|"; sid:920004; rev:1;)

alert tcp 192.168.200.0/24 any -> 192.168.1.0/24 any \
(msg:"LAB2: LAB → PROD Port Scan"; flags:S; threshold:type both, track by_src, count 20, seconds 10; sid:900008; rev:1;)


# ====== LATERAL MOVEMENT ======

alert tcp 192.168.200.0/24 any -> 192.168.1.0/24 [22,135,139,445,3389] \
(msg:"LAB2: LAB → PROD Unauthorized High-Risk Port"; sid:920005; rev:3;)

alert ip [10.20.0.0/24,192.168.3.0/24] any -> 192.168.200.0/24 any \
(msg:"LAB2: ISO → LAB2 Traffic (Policy Violation)"; sid:920006; rev:1;)


# ====== SMB / NETBIOS ======

alert tcp any any -> 192.168.200.0/24 445 \
(msg:"LAB2: SMBv1 Detected"; content:"|FF 53 4D 42|"; depth:4; sid:920008; rev:1;)

alert udp any any -> 192.168.200.0/24 137 \
(msg:"LAB2: NetBIOS Query Flood"; threshold:type both, track by_src, count 20, seconds 10; sid:920009; rev:1;)


# ====== TEST RULES ======

alert icmp any any -> 192.168.1.254 any \
(msg:"TEST: ICMP to pfSense VIP (LAB2)"; sid:920010; rev:1;)

alert tcp any any -> 192.168.1.254 443 \
(msg:"TEST: HTTPS to pfSense GUI (LAB2)"; sid:920011; rev:1;)