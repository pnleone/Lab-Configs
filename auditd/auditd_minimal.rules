## ===========================
##  Minimal SOC Ruleset
##  High-Signal, Low-Noise
##  Updated: 2026-02-07
## ===========================

-D
-b 8192

## -------------------------------
## 1. Process execution (core triage)
## -------------------------------
-a always,exit -F arch=b64 -S execve -k proc_exec
-a always,exit -F arch=b32 -S execve -k proc_exec

## -------------------------------
## 2. Privilege escalation attempts
## -------------------------------
-w /etc/sudoers -p r -k priv_esc
-w /etc/sudoers.d/ -p r -k priv_esc
-w /bin/su -p x -k priv_esc
-w /usr/bin/sudo -p x -k priv_esc
-w /etc/shadow -p r -k shadow_access

## -------------------------------
## 3. Authentication events
## -------------------------------
-w /var/log/secure -p wa -k auth
-w /var/log/auth.log -p wa -k auth

## -------------------------------
## 4. Critical system binaries
## -------------------------------
-w /bin/ -p x -k sys_bin
-w /usr/bin/ -p x -k sys_bin
-w /usr/sbin/ -p x -k sys_bin

## -------------------------------
## 5. Kernel module tampering
## -------------------------------
-w /sbin/insmod -p x -k kernel_mod
-w /sbin/rmmod -p x -k kernel_mod
-w /sbin/modprobe -p x -k kernel_mod
-w /lib/modules/ -p wa -k kernel_mod

## -------------------------------
## 6. User management
## -------------------------------
-w /etc/passwd -p wa -k user_mgmt
-w /etc/group -p wa -k user_mgmt
-w /etc/gshadow -p wa -k user_mgmt

## -------------------------------
## 7. Network configuration changes
## -------------------------------
-w /etc/hosts -p wa -k net_conf
-w /etc/hostname -p wa -k net_conf
-w /etc/resolv.conf -p wa -k net_conf

## =====================================================
## ADDITIONS FROM MINIMAL SOC RULESET (NO DUPLICATES)
## =====================================================

## -------------------------------
## SSH Keys & Config
## -------------------------------
-w /etc/ssh/sshd_config -p wa -k ssh
-w /etc/ssh/ssh_config -p wa -k ssh
-w /root/.ssh/ -p wa -k ssh
-w /home/ -p wa -k ssh_keys

## -------------------------------
## Systemd Service Tampering
## -------------------------------
-w /etc/systemd/system/ -p wa -k systemd
-w /usr/lib/systemd/system/ -p wa -k systemd
-w /run/systemd/system/ -p wa -k systemd

## -------------------------------
## Cron / Scheduled Tasks
## -------------------------------
-w /etc/cron.d/ -p wa -k cron
-w /etc/cron.daily/ -p wa -k cron
-w /etc/cron.hourly/ -p wa -k cron
-w /etc/cron.weekly/ -p wa -k cron
-w /etc/cron.monthly/ -p wa -k cron
-w /var/spool/cron/ -p wa -k cron

## -------------------------------
## Bootloader / GRUB
## -------------------------------
-w /boot/grub/ -p wa -k grub
-w /etc/default/grub -p wa -k grub

## -------------------------------
## Firewall / Security Config
## -------------------------------
-w /etc/ufw/ -p wa -k firewall
-w /etc/nftables.conf -p wa -k firewall
-w /etc/nftables/ -p wa -k firewall
-w /etc/pf.conf -p wa -k firewall

## -------------------------------
## Local Binaries (Persistence)
## -------------------------------
-w /usr/local/bin/ -p wa -k localbin
-w /usr/local/sbin/ -p wa -k localbin

## -------------------------------
## Auditd Self-Protection
## -------------------------------
-w /etc/audit/ -p wa -k auditd
-w /var/log/audit/ -p wa -k auditlog